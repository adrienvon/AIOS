# Agent Code Generator Node

A sophisticated MOFA node that uses AI to automatically generate Python code for dora-rs framework compliant agents. This node leverages large language models to create structured, production-ready agent code based on user specifications and configurations.

## Features

- **AI-Powered Code Generation**: Uses LLM to generate complete MOFA agent code
- **Structured Output**: Utilizes Pydantic models for consistent code structure
- **Configuration-Driven**: Parses agent configurations to customize code generation
- **File System Integration**: Automatically creates directory structures and files
- **Template Compliance**: Generates code that strictly follows dora-rs framework standards
- **Error Handling**: Includes comprehensive error containment in generated code

## Installation

Install the package in development mode:

```bash
pip install -e .
```

**Note**: This node requires additional dependencies that should be added to `pyproject.toml`:
- `openai` - for AI code generation
- `python-dotenv` - for environment variable management  
- `pydantic` - for structured data models

## Configuration

This node uses a comprehensive configuration system:

### Agent Configuration (`configs/agent.yml`)
Contains detailed prompts and templates for the AI code generator, including:
- Framework compliance requirements
- Code structure templates
- Implementation patterns
- Compliance checklist

### Environment Configuration (`.env.secret`)
Required for LLM API access (not included in repository for security).

### Input Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `query` | string | Yes | User specification for the agent to be generated |
| `agent_config` | string (JSON) | Yes | Configuration object containing agent_name and module_name |

### Output Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `code_generator_result` | string (JSON) | Generated agent information including code and metadata |

## Usage Example

### Basic Dataflow Configuration

```yaml
# agent_code_generator_dataflow.yml
nodes:
  - id: terminal-input
    build: pip install -e ../../node-hub/terminal-input
    path: dynamic
    outputs:
      - data
    inputs:
      agent_response: agent-code-generator/code_generator_result
  - id: agent-code-generator
    build: pip install -e ../../agent-hub/agent-code-generator
    path: agent-code-generator
    outputs:
      - code_generator_result
    inputs:
      query: terminal-input/data
      agent_config: terminal-input/agent_config
    env:
      IS_DATAFLOW_END: true
      WRITE_LOG: true
```

### Running the Node

1. **Start the MOFA framework:**
   ```bash
   dora up
   ```

2. **Build and start the dataflow:**
   ```bash
   dora build agent_code_generator_dataflow.yml
   dora start agent_code_generator_dataflow.yml
   ```

3. **Send input data:**
   Provide a user query and agent configuration JSON to generate agent code.

## Code Example

The core functionality is implemented in `main.py`:

```python
from mofa.agent_build.base.base_agent import MofaAgent, run_agent
from pydantic import BaseModel, Field

class AgentInfo(BaseModel):
    creation_time: str = Field(..., description="The creation time of the agent.")
    llm_generated_code: str = Field(..., description="The Python code generated by the LLM.")
    description: Optional[str] = Field(None, description="An optional description of the agent.")

@run_agent
def run(agent: MofaAgent):
    env_file_path = os.path.join(agent_config_dir_path, '.env.secret')
    agent_config_path = os.path.join(agent_config_dir_path, 'configs', 'agent.yml')
    
    # Receive parameters
    receive_data = agent.receive_parameters(['query', 'agent_config'])
    agent_name = json.loads(receive_data.get('agent_config')).get('agent_name')
    
    # Generate code using LLM
    user_query = f"user q: {receive_data.get('query')}  /n agent config: {receive_data.get('agent_config')}"
    result = generate_agent_config(response_model=AgentInfo, user_query=user_query, 
                                 agent_config_path=agent_config_path, env_file_path=env_file_path)
    
    # Create files if agent_name provided
    if agent_name:
        make_dir(f"{agent_name}/{module_name}")
        write_file(data=result.llm_generated_code, file_path=f"{agent_name}/{module_name}/main.py")
    
    agent.send_output(agent_output_name='code_generator_result', agent_result=result.json())
```

## Dependencies

- **pyarrow** (>= 5.0.0): For data serialization and arrow format support
- **openai**: For LLM API integration (needs to be added to pyproject.toml)
- **python-dotenv**: For environment variable management (needs to be added to pyproject.toml)
- **pydantic**: For structured data models (needs to be added to pyproject.toml)
- **mofa**: MOFA framework (automatically available in MOFA environment)

## Generated Code Features

The AI generator creates agents with:
- **Framework Compliance**: Strict adherence to dora-rs standards
- **MofaAgent Base Class**: Proper inheritance and decoration
- **Input/Output Handling**: Correct parameter receiving and output sending
- **Error Handling**: Comprehensive error containment
- **Type Safety**: Proper type conversions and serialization
- **Documentation**: Clear code structure and comments

## Use Cases

- **Rapid Agent Development**: Quickly generate boilerplate agent code
- **Framework Compliance**: Ensure generated agents follow dora-rs standards
- **Code Templates**: Create standardized agent patterns
- **Development Automation**: Automate repetitive agent creation tasks
- **Educational Tool**: Learn proper MOFA agent structure

## Contributing

1. Ensure your code follows the existing style
2. Add missing dependencies to pyproject.toml
3. Update documentation as needed
4. Test with various generation scenarios

## License

MIT License - see LICENSE file for details.

## Links

- [MOFA Framework](https://github.com/moxin-org/mofa)
- [MOFA Documentation](https://github.com/moxin-org/mofa/blob/main/README.md)